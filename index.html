<!DOCTYPE html>
<html>
<head>
  <title>Wacky Ragdoll VR</title>
  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-physics-system@v4.2.2/dist/aframe-physics-system.min.js"></script>
  <style>
    body { margin: 0; overflow: hidden; }
  </style>
</head>
<body>
  <a-scene physics="gravity: -9.8; debug: false">

    <!-- SKY -->
    <a-sky color="#4dc9f6"></a-sky>

    <!-- GROUND -->
    <a-plane 
      static-body 
      rotation="-90 0 0" 
      width="50" height="50" 
      color="#2ecc71"
      shadow="receive: true">
    </a-plane>

    <!-- WALLS TO BOUNCE OFF -->
    <a-box static-body position="0 2 -15" width="30" height="5" depth="0.5" color="#e74c3c"></a-box>
    <a-box static-body position="15 2 0" width="0.5" height="5" depth="30" color="#e74c3c"></a-box>
    <a-box static-body position="-15 2 0" width="0.5" height="5" depth="30" color="#e74c3c"></a-box>

    <!-- RAMPS FOR CHAOS -->
    <a-box static-body position="5 0.5 -8" rotation="-20 0 0" width="4" height="0.2" depth="6" color="#f39c12"></a-box>
    <a-box static-body position="-5 0.5 -6" rotation="-25 15 0" width="4" height="0.2" depth="6" color="#f39c12"></a-box>
    <a-box static-body position="0 1.5 -12" rotation="-30 0 0" width="6" height="0.2" depth="8" color="#e67e22"></a-box>

    <!-- PLATFORMS -->
    <a-box static-body position="3 3 -5" width="3" height="0.3" depth="3" color="#9b59b6"></a-box>
    <a-box static-body position="-4 2 -9" width="3" height="0.3" depth="3" color="#9b59b6"></a-box>

    <!-- SPINNING OBSTACLE -->
    <a-box 
      static-body 
      position="0 1.5 -7" 
      width="6" height="0.4" depth="0.4" 
      color="#e74c3c"
      animation="property: rotation; to: 0 360 0; loop: true; dur: 2000; easing: linear">
    </a-box>

    <!-- BOUNCY PILLARS -->
    <a-cylinder static-body position="3 1.5 -10" radius="0.5" height="3" color="#1abc9c"></a-cylinder>
    <a-cylinder static-body position="-3 1.5 -10" radius="0.5" height="3" color="#1abc9c"></a-cylinder>
    <a-cylinder static-body position="0 1.5 -14" radius="0.8" height="3" color="#1abc9c"></a-cylinder>

    <!-- VR CAMERA AND CONTROLLERS -->
    <a-entity id="rig" movement-controls="fly: true; speed: 0.3">
      <a-entity 
        camera 
        position="0 1.6 0" 
        look-controls="pointerLockEnabled: false">
      </a-entity>

      <!-- LEFT CONTROLLER - SPAWN RAGDOLLS -->
      <a-entity 
        id="leftHand"
        hand-controls="hand: left; handModelStyle: lowPoly" 
        laser-controls="hand: left"
        raycaster="objects: .grabbable; far: 50"
        ragdoll-spawner>
      </a-entity>

      <!-- RIGHT CONTROLLER - LAUNCH / PUNCH -->
      <a-entity 
        id="rightHand"
        hand-controls="hand: right; handModelStyle: lowPoly"
        laser-controls="hand: right"
        raycaster="objects: .grabbable; far: 50"
        ragdoll-launcher>
      </a-entity>
    </a-entity>

    <!-- SCORE DISPLAY -->
    <a-text 
      id="scoreText"
      value="RAGDOLLS: 0 | PRESS TRIGGER TO SPAWN" 
      position="0 4 -10" 
      align="center" 
      width="12" 
      color="#fff"
      font="mozillavr">
    </a-text>

    <!-- INSTRUCTIONS BOARD -->
    <a-entity position="0 3 -5">
      <a-plane width="5" height="2" color="#333" opacity="0.8"></a-plane>
      <a-text 
        value="LEFT TRIGGER: Spawn Ragdoll\nRIGHT TRIGGER: Launch Ragdoll\nGRIP: Spawn Explosion\nHave fun breaking stuff!" 
        position="0 0 0.01" 
        align="center" 
        width="4" 
        color="#fff">
      </a-text>
    </a-entity>

    <!-- LIGHT -->
    <a-light type="ambient" intensity="0.5"></a-light>
    <a-light type="directional" position="2 8 2" intensity="0.8" castShadow="true"></a-light>

  </a-scene>

  <script>
    // RAGDOLL COLORS
    const colors = ['#e74c3c','#3498db','#f1c40f','#2ecc71','#9b59b6','#e67e22','#1abc9c','#ff69b4','#ff6347','#00ffff'];
    let ragdollCount = 0;

    function randomColor() {
      return colors[Math.floor(Math.random() * colors.length)];
    }

    function randomBetween(min, max) {
      return Math.random() * (max - min) + min;
    }

    function updateScore() {
      ragdollCount++;
      document.getElementById('scoreText').setAttribute('value', 
        'RAGDOLLS: ' + ragdollCount + ' | GO CRAZY!');
    }

    // CREATE A RAGDOLL (chain of body parts with physics)
    function createRagdoll(position, velocity) {
      let scene = document.querySelector('a-scene');
      let baseColor = randomColor();
      let scale = randomBetween(0.5, 1.5);

      // HEAD
      let head = document.createElement('a-sphere');
      head.setAttribute('class', 'grabbable ragdoll-part');
      head.setAttribute('dynamic-body', 'mass: 2; linearDamping: 0.1');
      head.setAttribute('radius', 0.25 * scale);
      head.setAttribute('position', {
        x: position.x, 
        y: position.y + 1.2 * scale, 
        z: position.z
      });
      head.setAttribute('color', baseColor);
      scene.appendChild(head);

      // BODY
      let body = document.createElement('a-box');
      body.setAttribute('class', 'grabbable ragdoll-part');
      body.setAttribute('dynamic-body', 'mass: 5; linearDamping: 0.1');
      body.setAttribute('width', 0.5 * scale);
      body.setAttribute('height', 0.7 * scale);
      body.setAttribute('depth', 0.3 * scale);
      body.setAttribute('position', {
        x: position.x, 
        y: position.y + 0.5 * scale, 
        z: position.z
      });
      body.setAttribute('color', baseColor);
      scene.appendChild(body);

      // LEFT ARM
      let leftArm = document.createElement('a-box');
      leftArm.setAttribute('class', 'grabbable ragdoll-part');
      leftArm.setAttribute('dynamic-body', 'mass: 1; linearDamping: 0.1');
      leftArm.setAttribute('width', 0.6 * scale);
      leftArm.setAttribute('height', 0.15 * scale);
      leftArm.setAttribute('depth', 0.15 * scale);
      leftArm.setAttribute('position', {
        x: position.x - 0.55 * scale, 
        y: position.y + 0.8 * scale, 
        z: position.z
      });
      leftArm.setAttribute('color', baseColor);
      leftArm.setAttribute('rotation', {x: 0, y: 0, z: randomBetween(-30, 30)});
      scene.appendChild(leftArm);

      // RIGHT ARM
      let rightArm = document.createElement('a-box');
      rightArm.setAttribute('class', 'grabbable ragdoll-part');
      rightArm.setAttribute('dynamic-body', 'mass: 1; linearDamping: 0.1');
      rightArm.setAttribute('width', 0.6 * scale);
      rightArm.setAttribute('height', 0.15 * scale);
      rightArm.setAttribute('depth', 0.15 * scale);
      rightArm.setAttribute('position', {
        x: position.x + 0.55 * scale, 
        y: position.y + 0.8 * scale, 
        z: position.z
      });
      rightArm.setAttribute('color', baseColor);
      rightArm.setAttribute('rotation', {x: 0, y: 0, z: randomBetween(-30, 30)});
      scene.appendChild(rightArm);

      // LEFT LEG
      let leftLeg = document.createElement('a-box');
      leftLeg.setAttribute('class', 'grabbable ragdoll-part');
      leftLeg.setAttribute('dynamic-body', 'mass: 2; linearDamping: 0.1');
      leftLeg.setAttribute('width', 0.18 * scale);
      leftLeg.setAttribute('height', 0.6 * scale);
      leftLeg.setAttribute('depth', 0.18 * scale);
      leftLeg.setAttribute('position', {
        x: position.x - 0.15 * scale, 
        y: position.y - 0.2 * scale, 
        z: position.z
      });
      leftLeg.setAttribute('color', baseColor);
      scene.appendChild(leftLeg);

      // RIGHT LEG
      let rightLeg = document.createElement('a-box');
      rightLeg.setAttribute('class', 'grabbable ragdoll-part');
      rightLeg.setAttribute('dynamic-body', 'mass: 2; linearDamping: 0.1');
      rightLeg.setAttribute('width', 0.18 * scale);
      rightLeg.setAttribute('height', 0.6 * scale);
      rightLeg.setAttribute('depth', 0.18 * scale);
      rightLeg.setAttribute('position', {
        x: position.x + 0.15 * scale, 
        y: position.y - 0.2 * scale, 
        z: position.z
      });
      rightLeg.setAttribute('color', baseColor);
      scene.appendChild(rightLeg);

      // EYES (googly eyes for fun)
      let leftEye = document.createElement('a-sphere');
      leftEye.setAttribute('radius', 0.06 * scale);
      leftEye.setAttribute('color', '#fff');
      leftEye.setAttribute('dynamic-body', 'mass: 0.1');
      leftEye.setAttribute('position', {
        x: position.x - 0.08 * scale,
        y: position.y + 1.25 * scale,
        z: position.z + 0.2 * scale
      });
      scene.appendChild(leftEye);

      let rightEye = document.createElement('a-sphere');
      rightEye.setAttribute('radius', 0.06 * scale);
      rightEye.setAttribute('color', '#fff');
      rightEye.setAttribute('dynamic-body', 'mass: 0.1');
      rightEye.setAttribute('position', {
        x: position.x + 0.08 * scale,
        y: position.y + 1.25 * scale,
        z: position.z + 0.2 * scale
      });
      scene.appendChild(rightEye);

      // PUPILS
      let leftPupil = document.createElement('a-sphere');
      leftPupil.setAttribute('radius', 0.03 * scale);
      leftPupil.setAttribute('color', '#000');
      leftPupil.setAttribute('dynamic-body', 'mass: 0.05');
      leftPupil.setAttribute('position', {
        x: position.x - 0.08 * scale,
        y: position.y + 1.25 * scale,
        z: position.z + 0.25 * scale
      });
      scene.appendChild(leftPupil);

      let rightPupil = document.createElement('a-sphere');
      rightPupil.setAttribute('radius', 0.03 * scale);
      rightPupil.setAttribute('color', '#000');
      rightPupil.setAttribute('dynamic-body', 'mass: 0.05');
      rightPupil.setAttribute('position', {
        x: position.x + 0.08 * scale,
        y: position.y + 1.25 * scale,
        z: position.z + 0.25 * scale
      });
      scene.appendChild(rightPupil);

      // APPLY VELOCITY TO ALL PARTS
      let allParts = [head, body, leftArm, rightArm, leftLeg, rightLeg, leftEye, rightEye, leftPupil, rightPupil];

      if (velocity) {
        setTimeout(() => {
          allParts.forEach(part => {
            let bodyEl = part.body;
            if (bodyEl) {
              bodyEl.velocity.set(
                velocity.x + randomBetween(-2, 2), 
                velocity.y + randomBetween(0, 3), 
                velocity.z + randomBetween(-2, 2)
              );
              bodyEl.angularVelocity.set(
                randomBetween(-10, 10),
                randomBetween(-10, 10),
                randomBetween(-10, 10)
              );
            }
          });
        }, 100);
      }

      // AUTO REMOVE AFTER 30 SECONDS TO SAVE PERFORMANCE
      setTimeout(() => {
        allParts.forEach(part => {
          if (part.parentNode) part.parentNode.removeChild(part);
        });
      }, 30000);

      updateScore();
    }

    // EXPLOSION - LAUNCHES ALL NEARBY RAGDOLL PARTS
    function createExplosion(position) {
      let parts = document.querySelectorAll('.ragdoll-part');
      parts.forEach(part => {
        let partPos = part.getAttribute('position');
        let dx = partPos.x - position.x;
        let dy = partPos.y - position.y;
        let dz = partPos.z - position.z;
        let dist = Math.sqrt(dx*dx + dy*dy + dz*dz);

        if (dist < 10 && part.body) {
          let force = 30 / (dist + 0.5);
          part.body.velocity.set(
            dx * force + randomBetween(-5, 5),
            Math.abs(dy) * force + 10 + randomBetween(0, 10),
            dz * force + randomBetween(-5, 5)
          );
          part.body.angularVelocity.set(
            randomBetween(-20, 20),
            randomBetween(-20, 20),
            randomBetween(-20, 20)
          );
        }
      });

      // VISUAL EXPLOSION
      let boom = document.createElement('a-sphere');
      boom.setAttribute('position', position);
      boom.setAttribute('radius', 0.3);
      boom.setAttribute('color', '#ff6600');
      boom.setAttribute('material', 'opacity: 0.8; emissive: #ff6600; emissiveIntensity: 2');
      boom.setAttribute('animation', 'property: scale; to: 8 8 8; dur: 400; easing: easeOutQuad');
      boom.setAttribute('animation__fade', 'property: material.opacity; to: 0; dur: 400; easing: easeOutQuad');
      document.querySelector('a-scene').appendChild(boom);
      setTimeout(() => boom.remove(), 500);

      // SPAWN DEBRIS
      for (let i = 0; i < 8; i++) {
        let debris = document.createElement('a-box');
        debris.setAttribute('dynamic-body', 'mass: 0.5');
        debris.setAttribute('class', 'ragdoll-part');
        debris.setAttribute('width', randomBetween(0.1, 0.3));
        debris.setAttribute('height', randomBetween(0.1, 0.3));
        debris.setAttribute('depth', randomBetween(0.1, 0.3));
        debris.setAttribute('color', randomColor());
        debris.setAttribute('position', {
          x: position.x + randomBetween(-1, 1),
          y: position.y + randomBetween(0, 2),
          z: position.z + randomBetween(-1, 1)
        });
        document.querySelector('a-scene').appendChild(debris);
        setTimeout(() => {
          if (debris.body) {
            debris.body.velocity.set(
              randomBetween(-15, 15),
              randomBetween(5, 20),
              randomBetween(-15, 15)
            );
          }
        }, 50);
        setTimeout(() => debris.remove(), 15000);
      }
    }

    // LEFT CONTROLLER - SPAWN RAGDOLLS
    AFRAME.registerComponent('ragdoll-spawner', {
      init: function() {
        this.el.addEventListener('triggerdown', () => {
          let pos = this.el.getAttribute('position');
          let worldPos = new THREE.Vector3();
          this.el.object3D.getWorldPosition(worldPos);

          let direction = new THREE.Vector3(0, 0, -1);
          this.el.object3D.getWorldDirection(direction);

          let spawnPos = {
            x: worldPos.x + direction.x * 2,
            y: worldPos.y + direction.y * 2 + 3,
            z: worldPos.z + direction.z * 2
          };

          let velocity = {
            x: direction.x * 5,
            y: 5,
            z: direction.z * 5
          };

          createRagdoll(spawnPos, velocity);
        });

        // GRIP = EXPLOSION
        this.el.addEventListener('gripdown', () => {
          let worldPos = new THREE.Vector3();
          this.el.object3D.getWorldPosition(worldPos);

          let direction = new THREE.Vector3(0, 0, -1);
          this.el.object3D.getWorldDirection(direction);

          createExplosion({
            x: worldPos.x + direction.x * 3,
            y: worldPos.y + direction.y * 3,
            z: worldPos.z + direction.z * 3
          });
        });
      }
    });

    // RIGHT CONTROLLER - LAUNCH RAGDOLLS FAST
    AFRAME.registerComponent('ragdoll-launcher', {
      init: function() {
        this.el.addEventListener('triggerdown', () => {
          let worldPos = new THREE.Vector3();
          this.el.object3D.getWorldPosition(worldPos);

          let direction = new THREE.Vector3(0, 0, -1);
          this.el.object3D.getWorldDirection(direction);

          let spawnPos = {
            x: worldPos.x + direction.x * 1,
            y: worldPos.y + direction.y * 1,
            z: worldPos.z + direction.z * 1
          };

          let velocity = {
            x: direction.x * 20,
            y: direction.y * 20 + 5,
            z: direction.z * 20
          };

          createRagdoll(spawnPos, velocity);
        });

        // GRIP = SUPER EXPLOSION
        this.el.addEventListener('gripdown', () => {
          let worldPos = new THREE.Vector3();
          this.el.object3D.getWorldPosition(worldPos);
          createExplosion({
            x: worldPos.x,
            y: worldPos.y,
            z: worldPos.z
          });
        });
      }
    });

    // KEYBOARD CONTROLS FOR TESTING WITHOUT VR
    document.addEventListener('keydown', (e) => {
      if (e.key === ' ') {
        createRagdoll({x: randomBetween(-3, 3), y: 8, z: randomBetween(-8, -4)}, null);
      }
      if (e.key === 'e') {
        createExplosion({x: 0, y: 1, z: -7});
      }
      // R = RAIN OF RAGDOLLS
      if (e.key === 'r') {
        for (let i = 0; i < 5; i++) {
          setTimeout(() => {
            createRagdoll({
              x: randomBetween(-8, 8), 
              y: randomBetween(8, 15), 
              z: randomBetween(-12, -4)
            }, null);
          }, i * 200);
        }
      }
    });
  </script>
</body>
</html>
